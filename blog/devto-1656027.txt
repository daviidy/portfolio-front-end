3:I[9275,[],""]
5:I[1343,[],""]
6:I[4858,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"ThemeProvider"]
7:I[9736,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"TooltipProvider"]
8:I[6691,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"Dock"]
9:I[6691,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"DockIcon"]
a:I[9736,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"Tooltip"]
b:I[9736,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"TooltipTrigger"]
c:I[231,["231","static/chunks/231-2d095471957ff3d5.js","173","static/chunks/173-06ea4b2e1871cc35.js","308","static/chunks/app/blog/%5Bslug%5D/page-180ef92bcd4a6ad4.js"],""]
d:I[9736,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"TooltipContent"]
e:I[9973,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"Separator"]
10:I[7363,["310","static/chunks/0e5ce63c-e21fe8bbb1ba0e0f.js","231","static/chunks/231-2d095471957ff3d5.js","633","static/chunks/633-2667c71f837e2c91.js","685","static/chunks/685-38d3d3a09bf3d7e5.js","392","static/chunks/392-a90341f24030e785.js","185","static/chunks/app/layout-a6b5bc5d75b10efa.js"],"ModeToggle"]
4:["slug","devto-1656027","d"]
f:T843,M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8-33.598-19.607-70.277-29.408-110.063-29.408-39.781 0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168 0 184.854 0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562 0-.571-.049-5.708-.144-15.417a2549.81 2549.81 0 01-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289 1.525-.859 4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136 6.28 0 11.704-.476 16.274-1.423 4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826 0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817 0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906-.01-39.771-9.818-76.454-29.414-110.049z0:["WuZYG7sBH1ii_SPpGKIwW",[[["",{"children":["blog",{"children":[["slug","devto-1656027","d"],{"children":["__PAGE__?{\"slug\":\"devto-1656027\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","devto-1656027","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"min-h-screen bg-background font-sans antialiased max-w-2xl mx-auto py-12 sm:py-24 px-6 __variable_18454d","children":[["$","$L6",null,{"attribute":"class","defaultTheme":"light","children":["$","$L7",null,{"delayDuration":0,"children":[["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":"404"}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],"notFoundStyles":[],"styles":null}],["$","div",null,{"className":"pointer-events-none fixed inset-x-0 bottom-0 z-30 mx-auto mb-4 flex origin-bottom h-full max-h-14","children":[["$","div",null,{"className":"fixed bottom-0 inset-x-0 h-16 w-full bg-background to-transparent backdrop-blur-lg [-webkit-mask-image:linear-gradient(to_top,black,transparent)] dark:bg-background"}],["$","$L8",null,{"className":"z-50 pointer-events-auto relative mx-auto flex min-h-full h-full items-center px-1 bg-background [box-shadow:0_0_0_1px_rgba(0,0,0,.03),0_2px_4px_rgba(0,0,0,.05),0_12px_24px_rgba(0,0,0,.05)] transform-gpu dark:[border:1px_solid_rgba(255,255,255,.1)] dark:[box-shadow:0_-20px_80px_-20px_#ffffff1f_inset] ","children":[[["$","$L9","/",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"/","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-home size-4","children":[["$","path","y5dka4",{"d":"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}],["$","polyline","e2us08",{"points":"9 22 9 12 15 12 15 22"}],"$undefined"]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"Home"}]}]]}]}],["$","$L9","/blog",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"/blog","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-notebook size-4","children":[["$","path","aawbzj",{"d":"M2 6h4"}],["$","path","l0bgd4",{"d":"M2 10h4"}],["$","path","1gsvsf",{"d":"M2 14h4"}],["$","path","1bu2t1",{"d":"M2 18h4"}],["$","rect","1nb95v",{"width":"16","height":"20","x":"4","y":"2","rx":"2"}],["$","path","rotuqe",{"d":"M16 2v20"}],"$undefined"]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"Blog"}]}]]}]}],["$","$L9","/ebook",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"/ebook","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-book size-4","children":[["$","path","t4utmx",{"d":"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"}],"$undefined"]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"Free Ebook"}]}]]}]}]],["$","$Le",null,{"orientation":"vertical","className":"h-full"}],[["$","$L9","GitHub",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"https://github.com/daviidy","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"viewBox":"0 0 438.549 438.549","className":"size-4","children":["$","path",null,{"fill":"currentColor","d":"$f"}]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"GitHub"}]}]]}]}],["$","$L9","LinkedIn",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"https://www.linkedin.com/in/nda-yao/","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"viewBox":"0 0 24 24","xmlns":"http://www.w3.org/2000/svg","className":"size-4","children":[["$","title",null,{"children":"LinkedIn"}],["$","path",null,{"fill":"currentColor","d":"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"}]]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"LinkedIn"}]}]]}]}],["$","$L9","X",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"https://x.com/davidyao_dev","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"viewBox":"0 0 24 24","xmlns":"http://www.w3.org/2000/svg","className":"size-4","children":[["$","title",null,{"children":"X"}],["$","path",null,{"fill":"currentColor","d":"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"}]]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"X"}]}]]}]}],["$","$L9","Youtube",{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$Lc",null,{"href":"https://www.youtube.com/@davidyao_dev","className":"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground rounded-full size-12","children":["$","svg",null,{"width":"32px","height":"32px","viewBox":"0 0 32 32","fill":"currentColor","xmlns":"http://www.w3.org/2000/svg","className":"size-4","children":[["$","title",null,{"children":"youtube"}],["$","path",null,{"d":"M29.41,9.26a3.5,3.5,0,0,0-2.47-2.47C24.76,6.2,16,6.2,16,6.2s-8.76,0-10.94.59A3.5,3.5,0,0,0,2.59,9.26,36.13,36.13,0,0,0,2,16a36.13,36.13,0,0,0,.59,6.74,3.5,3.5,0,0,0,2.47,2.47C7.24,25.8,16,25.8,16,25.8s8.76,0,10.94-.59a3.5,3.5,0,0,0,2.47-2.47A36.13,36.13,0,0,0,30,16,36.13,36.13,0,0,0,29.41,9.26ZM13.2,20.2V11.8L20.47,16Z"}]]}]}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"Youtube"}]}]]}]}]],["$","$Le",null,{"orientation":"vertical","className":"h-full py-2"}],["$","$L9",null,{"children":["$","$La",null,{"children":[["$","$Lb",null,{"asChild":true,"children":["$","$L10",null,{}]}],["$","$Ld",null,{"children":["$","p",null,{"children":"Theme"}]}]]}]}]]}]]}]]}]}],["$","script",null,{"dangerouslySetInnerHTML":{"__html":"\n              (function() {\n                var s = document.createElement('script');\n                s.type = 'text/javascript';\n                s.async = true;\n                s.src = 'https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=Yxt67z';\n                var h = document.getElementsByTagName('script')[0];\n                h.parentNode.insertBefore(s, h);\n              })();\n            "}}]]}]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"https://david-yao.com/_next/static/css/ed41849a871095d2.css","precedence":"next","crossOrigin":"$undefined"}]],"$L11"]]]]
11:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"How to implement Token-Based Authentication and Authorization in Rails | Nda David Yao"}],["$","meta","3",{"name":"description","content":"\"Technologies change, but the basics are the same\". That's what my mentor told me years ago when I..."}],["$","meta","4",{"name":"robots","content":"index, follow"}],["$","meta","5",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","meta","6",{"property":"og:title","content":"How to implement Token-Based Authentication and Authorization in Rails"}],["$","meta","7",{"property":"og:description","content":"\"Technologies change, but the basics are the same\". That's what my mentor told me years ago when I..."}],["$","meta","8",{"property":"og:url","content":"https://dev.to/daviidy/how-to-implement-authentication-and-authorization-api-in-rails-51nj"}],["$","meta","9",{"property":"og:image","content":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fqh6jn4lt6p7at870n9wv.png"}],["$","meta","10",{"property":"og:type","content":"article"}],["$","meta","11",{"property":"article:published_time","content":"2023-11-30T06:16:47Z"}],["$","meta","12",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","13",{"name":"twitter:title","content":"How to implement Token-Based Authentication and Authorization in Rails"}],["$","meta","14",{"name":"twitter:description","content":"\"Technologies change, but the basics are the same\". That's what my mentor told me years ago when I..."}],["$","meta","15",{"name":"twitter:image","content":"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fqh6jn4lt6p7at870n9wv.png"}],["$","link","16",{"rel":"shortcut icon","href":"/dave.png"}],["$","link","17",{"rel":"icon","href":"/dave.png"}],["$","link","18",{"rel":"apple-touch-icon","href":"/dave.png"}],["$","meta","19",{"name":"next-size-adjust"}]]
1:null
12:"$Sreact.suspense"
14:I[8173,["231","static/chunks/231-2d095471957ff3d5.js","173","static/chunks/173-06ea4b2e1871cc35.js","308","static/chunks/app/blog/%5Bslug%5D/page-180ef92bcd4a6ad4.js"],"Image"]
13:T13b99,<p>"Technologies change, but the basics are the same". That's what my mentor told me years ago when I asked him how I could be a great software engineer. And it's so true especially when it comes to securing an API with a token-based authentication. No matter the framework you use (Spring, Rails, Laravel, etc.), the principle is the same. So in this blog post, we will discuss how to implement it successfully in your Rails application.</p>
<h2>The project:</h2>
<p>We want to create a backend API for an app like <a href="https://www.hackerrank.com/">Hackerrank</a>.
Here is the Database Design and Entity-Relationship Diagram (ERD) for the API.</p>
<p>For the entities, we have:
- Users
- Challenges (Programming questions)
- Submissions (User solutions to challenges)
- Categories (Challenge categories)
- Comments (User comments on challenges)
- Ratings (User ratings for challenges)
- Test Cases (Input and expected output for challenges)</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/s00w7deqg0n3pgyia5vv.png" alt="Image description"></p>
<p>Here are some relationships from the diagram above:
- A User has many Submissions.
- A Challenge belongs to a Category.
- A Challenge has many Test Cases.
- Only admins can create, update, or delete challenges, submissions, categories, or test cases.</p>
<p>Now, let's focus on implementing the authentication and authorization for our API. I assume you already know how to install a rails application focused on an API implementation, how to generate controllers and models.
We will go with the basic MVC architecture provided by Rails.</p>
<h2>Install the necessary gems</h2>
<ul>
<li>Add this to your <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Gemfile</span></span></code></span>:</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">gem </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'bcrypt'</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"> # For hashing passwords</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">gem </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'jwt'</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">   # For JWT authentication</span></span></code></pre></figure>
<p><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>bcrypt</span></span></code></span> will be used for password-hashing.
<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>jwt</span></span></code></span> will be used to successfully log the user in and handle authorization.</p>
<ul>
<li>Create a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>secret_key_generator</span></span></code></span> file in your <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>initializers</span></span></code></span> folder and paste this:</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># config/initializers/secret_key_generator.rb</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># Require the SecureRandom module</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">require</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'securerandom'</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># Generate a random secret key</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">secret_key </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> SecureRandom</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.hex(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">32</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">) </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># Adjust the size as needed (e.g., 64 characters for a 256-bit key)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># Set the secret key as an environment variable</span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ENV</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'APP_SECRET_KEY'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> secret_key</span></span>
<span data-line=""> </span></code></pre></figure>
<p>Initializers are executed when the Rails application boots. In our case, this initializer generates a random secret key using SecureRandom and sets it as an environment variable (APP_SECRET_KEY). We will use it to decode JWT tokens.</p>
<h2>Create the models and migration files</h2>
<ul>
<li>User</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> User</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationRecord</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  enum </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">role:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">default:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 0</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">admin:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:name</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">presence:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:email</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">presence:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  validates_uniqueness_of </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:email</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:password</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">presence:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">length:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">minimum:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 6</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  has_secure_password</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> admin?</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    role </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">==</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'admin'</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> CreateUsers</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ActiveRecord::Migration</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">7.1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> change</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    create_table </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:users</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> do</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> |t|</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.string </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:name</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.string </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:email</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.string </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:password_digest</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.integer </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:role</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.timestamps</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<ul>
<li>Category</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> Category</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationRecord</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:title</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">presence:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:description</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">allow_blank:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    has_many </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenge_categories</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    has_many </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenges</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">through:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :challenge_categories</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> CreateCategories</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ActiveRecord::Migration</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">7.1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> change</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    create_table </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:categories</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> do</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> |t|</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.string </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:title</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.text </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:description</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:null</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> => </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">true</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.timestamps</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<ul>
<li>Challenge</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> Challenge</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationRecord</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:title</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">presence:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    validates </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:description</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">presence:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    has_many </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenge_categories</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    has_many </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:categories</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">through:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :challenge_categories</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> CreateChallenges</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ActiveRecord::Migration</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">7.1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> change</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    create_table </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenges</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> do</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> |t|</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.string </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:title</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.text </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:description</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.timestamps</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<p>And since there is a many-to-many relationship between Challenge and Category, let's add the pivot table:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> CreateChallengeCategories</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ActiveRecord::Migration</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">7.1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> change</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    create_table </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenge_categories</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> do</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> |t|</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.references </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenge</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">null:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> false</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">foreign_key:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.references </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:category</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">null:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> false</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">foreign_key:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> true</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      t.timestamps</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<h2>Add the routes</h2>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">resources </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:users</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">only:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:create</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  namespace </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:auth</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> do</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    post </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'/login'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">to:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'sessions#create'</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    delete </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'/logout'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">to:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'sessions#destroy'</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  resources </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenges</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  post </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'/admin'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">to:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'users#add_admin'</span></span></code></pre></figure>
<p>You may have guessed it, but you will need to create a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>controllers/auth</span></span></code></span> folder. I'll explain why in a few minutes.</p>
<h2>Authentication logic</h2>
<ul>
<li>Add this to your <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>users_controller</span></span></code></span> file:</li>
</ul>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> UsersController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationController</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> create</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    @user </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> User</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">new</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(user_params)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @user.save</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Registration successful. Please log in.'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :created</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">errors:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @user.errors.full_messages }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> add_admin</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    email </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> params[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:email</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> email.blank?</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">errors:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Email parameter is required'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    @user </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> User</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.find_by(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">email:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> email)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @user.nil?</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">errors:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'No user with that Email found'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :not_found</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      @user.update_column(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:role</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'User is now an admin'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :ok</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  private</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> user_params</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      params.require(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:user</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">).permit(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:name</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:email</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:password</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:password_confirmation</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<p>That controller is simply responsible for creating new users and admins.</p>
<p>Create a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>helpers/token_helper</span></span></code></span> file in your <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>app</span></span></code></span> folder and add this code:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># app/helpers/token_helper.rb</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">module</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> TokenHelper</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> decode_token</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(token)</span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">    JWT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.decode(token, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ENV</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'APP_SECRET_KEY'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">], </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">true</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">algorithm:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'HS256'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">0</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  rescue</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> JWT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">::</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">DecodeError</span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">    nil</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<p>And include it in your <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>application_controller</span></span></code></span>:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">include</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> TokenHelper</span></span></code></pre></figure>
<p>Now let's create a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>sessions_controller</span></span></code></span> in our <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>auth</span></span></code></span> folder and add this code:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># app/controllers/sessions_controller.rb</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> Auth::SessionsController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationController</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> create</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    user </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> User</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.find_by(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">email:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> params[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:email</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">])</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> user </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">&#x26;&#x26;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> user.authenticate(params[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:password</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">])</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">        # Set the expiration time (e.g., 1 hour from now)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        expiration_time </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Time</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.now.to_i </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">+</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">3600</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> *</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 3</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">) </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># 3600 seconds = 1 hour</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">        # Create the payload</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        payload </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">            user_id:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> user.id,</span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">            exp:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> expiration_time </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># This sets the expiration time</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        }</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        token </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> JWT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.encode(payload, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ENV</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'APP_SECRET_KEY'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">], </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'HS256'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Logged in successfully'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">token:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> token }</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">error:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Invalid credentials'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unauthorized</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> destroy</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">    # Invalidate the JWT token by marking it as expired or revoking it.</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    token </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> extract_token_from_request</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> token</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">      begin</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">        # Try to decode the token to check its validity</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        payload, _ </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> JWT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.decode(token, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ENV</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'APP_SECRET_KEY'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">], </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">true</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">algorithm:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'HS256'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">        # At this point, the token is considered valid</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">        # Add expiration to the payload to mark the token as invalid</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        payload[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'exp'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Time</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.now.to_i</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        new_token </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> JWT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.encode(payload, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ENV</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'APP_SECRET_KEY'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">], </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'HS256'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Logged out successfully'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">      rescue</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> JWT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">::</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">DecodeError</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">        # JWT::DecodeError is raised when the token is not valid</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'You need to sign in or sign up before continuing'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unauthorized</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">      end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'No token found'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  private</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> extract_token_from_request</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    request.headers[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'Authorization'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]&#x26;.split&#x26;.last</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<p>What we did there basically is generate a new token when a user logs in and invalidate a token when a user logs out. Remember, the token is used to check if a user session is valid or not. If you don't know how JWT tokens work, check the documentation <a href="https://en.wikipedia.org/wiki/JSON_Web_Token">here</a>.</p>
<p>Now if you request <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>POST /users</span></span></code></span> and <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>POST /login</span></span></code></span> with the correct parameters using Postman, it should work.</p>
<h2>Add the Challenge and Category controllers:</h2>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ChallengesController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationController</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    before_action </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:set_challenge</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">only:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:show</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:update</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:destroy</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    before_action </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:authorize_user</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">except:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:index</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:show</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    before_action </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:authorize_admin</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">except:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:index</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:show</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> index</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        @challenges </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Challenge</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.all</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenges</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> show</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> create</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        @challenge </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Challenge</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">new</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(challenge_params)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge.save</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :created</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge.errors, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> update</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge.update(challenge_params)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @challenge.errors, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> destroy</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        @challenge.destroy</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">message:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Challenge was successfully deleted'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    private</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> set_challenge</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        @challenge </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Challenge</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.find(params[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:id</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">])</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> challenge_params</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        params.require(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:challenge</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">).permit(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:title</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:description</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">category_ids:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [])</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> CategoriesController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &#x3C;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> ApplicationController</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  before_action </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:set_category</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">only:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:show</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:update</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:destroy</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  before_action </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:authorize_user</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">except:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:index</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:show</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  before_action </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:authorize_admin</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">except:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:index</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:show</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> index</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    @categories </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Category</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.all</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @categories</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> show</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> create</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    @category </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Category</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">new</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(category_params)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category.save</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :created</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category.errors, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> update</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category.update(category_params)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> @category.errors, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unprocessable_entity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> destroy</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    @category.destroy</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    head </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:no_content</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  private</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> set_category</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    @category </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> Category</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.find(params[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:id</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">])</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> category_params</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    params.require(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:category</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">).permit(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:title</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">:description</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">challenge_ids:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> [])</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">end</span></span>
<span data-line=""> </span></code></pre></figure>
<p>As you can see, both controllers check if the user session is valid before executing some controller actions (create, update, delete). They are doing so with authorize_user and authorize_admin.
Add those methods in your application_controller:</p>
<figure data-rehype-pretty-code-figure=""><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ruby" data-theme="github-dark github-light"><code data-language="ruby" data-theme="github-dark github-light" style="display: grid;"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> authorize_user</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        token </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> request.headers[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'Authorization'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">]&#x26;.split(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">' '</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)&#x26;.last</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">        payload </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> decode_token(token)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> payload.nil?</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">error:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Unauthorized'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unauthorized</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        else</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            @current_user </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> User</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.find(payload[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">'user_id'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">])</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    def</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> authorize_admin</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        if</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> !</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">@current_user </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">||</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> !</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">@current_user.admin?</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">            render </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">json:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">error:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> 'Unauthorized'</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> }, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">status:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> :unauthorized</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">        end</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    end</span></span></code></pre></figure>
<p>Now, try to create a challenge without logging in and you should get an <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Unauthorized</span></span></code></span> message. Log in, set the current user as admin, try again and it should work.</p>
<p>Et voila, let me know in the comments section if you found this article helpful.</p>2:["$","section",null,{"id":"blog","children":[["$","script",null,{"type":"application/ld+json","suppressHydrationWarning":true,"dangerouslySetInnerHTML":{"__html":"{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"How to implement Token-Based Authentication and Authorization in Rails\",\"datePublished\":\"2023-11-30T06:16:47Z\",\"dateModified\":\"2023-11-30T06:16:47Z\",\"description\":\"\\\"Technologies change, but the basics are the same\\\". That's what my mentor told me years ago when I...\",\"image\":\"https://media2.dev.to/dynamic/image/width=1000,height=420,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2Fqh6jn4lt6p7at870n9wv.png\",\"url\":\"https://dev.to/daviidy/how-to-implement-authentication-and-authorization-api-in-rails-51nj\",\"author\":{\"@type\":\"Person\",\"name\":\"Nda David Yao\"}}"}}],["$","h1",null,{"className":"title font-medium text-2xl tracking-tighter max-w-[650px]","children":"How to implement Token-Based Authentication and Authorization in Rails"}],["$","div",null,{"className":"flex justify-between items-center mt-2 mb-8 text-sm max-w-[650px]","children":[["$","$12",null,{"fallback":["$","p",null,{"className":"h-5"}],"children":["$","p",null,{"className":"text-sm text-neutral-600 dark:text-neutral-400","children":"November 30, 2023 (1y ago)"}]}],["$","$Lc",null,{"href":"https://dev.to/daviidy/how-to-implement-authentication-and-authorization-api-in-rails-51nj","target":"_blank","rel":"noopener noreferrer","className":"text-sm text-neutral-600 dark:text-neutral-400 hover:text-neutral-800 dark:hover:text-neutral-200","children":"Read on Dev.to →"}]]}],["$","article",null,{"className":"prose dark:prose-invert max-w-none prose-pre:bg-neutral-100 dark:prose-pre:bg-neutral-900 prose-pre:border prose-pre:border-neutral-200 dark:prose-pre:border-neutral-800 prose-pre:rounded-lg prose-code:before:content-none prose-code:after:content-none prose-code:font-normal prose-code:bg-neutral-100 dark:prose-code:bg-neutral-900 prose-code:rounded prose-code:px-1 prose-code:py-0.5 prose-code:text-neutral-800 dark:prose-code:text-neutral-200 prose-a:text-blue-500 hover:prose-a:text-blue-400 prose-headings:font-medium prose-h2:text-xl prose-h2:tracking-tight prose-p:leading-7 prose-li:leading-7","dangerouslySetInnerHTML":{"__html":"$13"}}],["$","div",null,{"className":"mt-16","children":[["$","div",null,{"className":"flex items-center justify-between mb-8","children":[["$","h2",null,{"className":"text-xl font-medium tracking-tighter","children":["Comments (",1,")"]}],["$","$Lc",null,{"href":"https://dev.to/daviidy/how-to-implement-authentication-and-authorization-api-in-rails-51nj#comments","target":"_blank","rel":"noopener noreferrer","children":"Add Comment","className":"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2"}]]}],["$","div",null,{"className":"space-y-8","children":[["$","div",null,{"className":"flex gap-4","children":[["$","div",null,{"className":"flex-shrink-0","children":["$","$L14",null,{"src":"https://media2.dev.to/dynamic/image/width=640,height=640,fit=cover,gravity=auto,format=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Fuser%2Fprofile_image%2F1120282%2F9ecbab3b-8cda-4acd-92fc-bf4eb86d4bbc.jpeg","alt":"CedricLapi","width":40,"height":40,"className":"rounded-full"}]}],["$","div",null,{"className":"flex-1","children":[["$","div",null,{"className":"flex items-center gap-2 mb-2","children":[["$","span",null,{"className":"font-medium","children":"CedricLapi"}],["$","span",null,{"className":"text-sm text-neutral-600 dark:text-neutral-400","children":["@","cedriclapi"]}],["$","span",null,{"className":"text-sm text-neutral-600 dark:text-neutral-400","children":["• ","November 30, 2023 (1y ago)"]}]]}],["$","div",null,{"className":"prose dark:prose-invert","dangerouslySetInnerHTML":{"__html":"<p>Nice article, quite interesting!</p>\n\n"}}],false]}]]}]]}]]}]]}]
